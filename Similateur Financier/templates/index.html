<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinRisk Simulator</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <i class="fas fa-chart-line text-blue-600 text-2xl mr-3"></i>
                    <span class="font-bold text-xl">FinRisk Simulator</span>
                </div>
                <div class="flex space-x-8">
                    <a href="#dashboard" class="nav-link active">Tableau de Bord</a>
                    <a href="#simulations" class="nav-link">Simulations</a>
                    <a href="#portfolios" class="nav-link">Portefeuilles</a>
                    <a href="#reports" class="nav-link">Rapports</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Contenu Principal -->
    <main class="max-w-7xl mx-auto py-6 px-4">
        <!-- Section Tableau de Bord -->
        <section id="dashboard" class="section">
            <h2 class="text-2xl font-bold mb-6">Tableau de Bord</h2>

            <!-- Métriques en Temps Réel -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="metric-card bg-white p-6 rounded-lg shadow">
                    <div class="flex items-center">
                        <i class="fas fa-exclamation-triangle text-red-500 text-2xl mr-3"></i>
                        <div>
                            <h3 class="text-sm font-semibold text-gray-500">VaR 95%</h3>
                            <p class="text-2xl font-bold" data-metric="var">-</p>
                        </div>
                    </div>
                </div>

                <div class="metric-card bg-white p-6 rounded-lg shadow">
                    <div class="flex items-center">
                        <i class="fas fa-bolt text-orange-500 text-2xl mr-3"></i>
                        <div>
                            <h3 class="text-sm font-semibold text-gray-500">Stress Test</h3>
                            <p class="text-2xl font-bold" data-metric="stress">-</p>
                        </div>
                    </div>
                </div>

                <div class="metric-card bg-white p-6 rounded-lg shadow">
                    <div class="flex items-center">
                        <i class="fas fa-shield-alt text-blue-500 text-2xl mr-3"></i>
                        <div>
                            <h3 class="text-sm font-semibold text-gray-500">Couverture SCR</h3>
                            <p class="text-2xl font-bold" data-metric="scr">-</p>
                        </div>
                    </div>
                </div>

                <div class="metric-card bg-white p-6 rounded-lg shadow">
                    <div class="flex items-center">
                        <i class="fas fa-euro-sign text-green-500 text-2xl mr-3"></i>
                        <div>
                            <h3 class="text-sm font-semibold text-gray-500">Valeur Portefeuille</h3>
                            <p class="text-2xl font-bold" data-metric="portfolio">-</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Graphiques -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <!-- Graphique PETIT & COMPACT -->
                <div class="w-full max-w-xs mx-auto my-6">
                  <canvas id="allocationChart" class="w-full h-48"></canvas>
                </div>
                <div class="bg-white p-6 rounded-lg shadow">
                    <canvas id="risk-chart" height="100"></canvas>
                </div>
            </div>

            <!-- Simulations Récentes -->
            <div class="bg-white rounded-lg shadow">
                <div class="p-6 border-b">
                    <h3 class="text-lg font-semibold">Simulations Récentes</h3>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left">Nom</th>
                                <th class="px-4 py-3 text-left">Type</th>
                                <th class="px-4 py-3 text-left">Date</th>
                                <th class="px-4 py-3 text-left">Statut</th>
                                <th class="px-4 py-3 text-left">Résultat</th>
                                <th class="px-4 py-3 text-left">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="dashboard-simulations-table">
                            <!-- Rempli dynamiquement -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Section Simulations -->
        <section id="simulations" class="section hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">Simulations</h2>
                <button onclick="finRiskApp.runSimulation()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                    <i class="fas fa-plus mr-2"></i>Nouvelle Simulation
                </button>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="font-semibold mb-4">Test de Stress</h3>
                    <p class="text-gray-600 mb-4">Simulez l'impact de scénarios de crise</p>
                    <button onclick="finRiskApp.showSimulationForm('stress_test')" class="w-full bg-red-100 text-red-700 px-4 py-2 rounded hover:bg-red-200">
                        Lancer un test
                    </button>
                </div>

                <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="font-semibold mb-4">Solvabilité II</h3>
                    <p class="text-gray-600 mb-4">Calculez les exigences réglementaires</p>
                    <button onclick="finRiskApp.showSimulationForm('solvency_ii')" class="w-full bg-blue-100 text-blue-700 px-4 py-2 rounded hover:bg-blue-200">
                        Calculer SCR
                    </button>
                </div>

                <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="font-semibold mb-4">Risque de Marché</h3>
                    <p class="text-gray-600 mb-4">Analyse VaR et Expected Shortfall</p>
                    <button onclick="finRiskApp.showSimulationForm('market_risk')" class="w-full bg-green-100 text-green-700 px-4 py-2 rounded hover:bg-green-200">
                        Calculer VaR
                    </button>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow">
                <div class="p-6 border-b">
                    <h3 class="text-lg font-semibold">Simulations Récentes</h3>
                </div>
                <div class="p-6">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left">Nom</th>
                                <th class="px-4 py-3 text-left">Type</th>
                                <th class="px-4 py-3 text-left">Date</th>
                                <th class="px-4 py-3 text-left">Statut</th>
                                <th class="px-4 py-3 text-left">Résultat</th>
                            </tr>
                        </thead>
                        <tbody id="simulations-table">
                            <!-- Rempli dynamiquement -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Section Portefeuilles -->
        <section id="portfolios" class="section hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">Portefeuilles</h2>
                <button onclick="finRiskApp.showPortfolioForm()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                    <i class="fas fa-plus mr-2"></i>Nouveau Portefeuille
                </button>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="font-semibold text-lg mb-2">Portefeuille Principal</h3>
                    <p class="text-gray-600 mb-4">Portefeuille de démonstration</p>
                    <div class="flex justify-between items-center">
                        <span class="text-2xl font-bold text-green-600">€156.7M</span>
                        <button class="text-blue-600 hover:text-blue-800">
                            <i class="fas fa-edit"></i>
                        </button>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-lg shadow border-2 border-dashed border-gray-300 flex items-center justify-center min-h-[200px]">
                    <button onclick="finRiskApp.showPortfolioForm()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-plus text-4xl mb-2"></i>
                        <p>Ajouter un portefeuille</p>
                    </button>
                </div>
            </div>
        </section>

        <!-- Section Rapports -->
        <section id="reports" class="section hidden">
            <h2 class="text-2xl font-bold mb-6">Rapports</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="font-semibold mb-4">Rapports de Simulation</h3>
                    <p class="text-gray-600 mb-4">Générez des rapports détaillés pour vos analyses de risque</p>
                    <button onclick="finRiskApp.generateReport()" class="w-full bg-purple-100 text-purple-700 px-4 py-2 rounded hover:bg-purple-200">
                        <i class="fas fa-file-pdf mr-2"></i>Générer un rapport
                    </button>
                </div>

                <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="font-semibold mb-4">Historique des Analyses</h3>
                    <p class="text-gray-600 mb-4">Consultez l'historique complet de vos simulations</p>
                    <button onclick="finRiskApp.showReportHistory()" class="w-full bg-indigo-100 text-indigo-700 px-4 py-2 rounded hover:bg-indigo-200">
                        <i class="fas fa-history mr-2"></i>Voir l'historique
                    </button>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow">
                <div class="p-6 border-b">
                    <h3 class="text-lg font-semibold">Derniers Rapports Générés</h3>
                </div>
                <div class="p-6">
                    <div class="space-y-4">
                        <div class="flex justify-between items-center p-4 border rounded">
                            <div>
                                <h4 class="font-semibold">Rapport Stress Test - Mars 2024</h4>
                                <p class="text-gray-600">Analyse de résistance aux scénarios de crise</p>
                            </div>
                            <button class="text-blue-600 hover:text-blue-800">
                                <i class="fas fa-download"></i> Télécharger
                            </button>
                        </div>

                        <div class="flex justify-between items-center p-4 border rounded">
                            <div>
                                <h4 class="font-semibold">Calcul SCR - Février 2024</h4>
                                <p class="text-gray-600">Exigences de solvabilité Solvabilité II</p>
                            </div>
                            <button class="text-blue-600 hover:text-blue-800">
                                <i class="fas fa-download"></i> Télécharger
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Loading Overlay -->
    <div id="loading" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white p-6 rounded-lg shadow-xl">
            <i class="fas fa-spinner fa-spin text-2xl text-blue-600"></i>
            <span class="ml-3">Simulation en cours...</span>
        </div>
    </div>

    <!-- Modals -->
    <!-- Modal Simulation -->
    <div id="simulation-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b">
                <h3 class="text-xl font-bold" id="simulation-modal-title">Nouvelle Simulation</h3>
            </div>
            <div class="p-6">
                <form id="simulation-form">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Type de Simulation</label>
                            <select id="simulation-type" class="w-full p-2 border rounded" required>
                                <option value="stress_test">Test de Stress</option>
                                <option value="solvency_ii">Solvabilité II</option>
                                <option value="market_risk">Risque de Marché</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium mb-2">Portefeuille</label>
                            <select id="portfolio-select" class="w-full p-2 border rounded" required>
                                <option value="1">Portefeuille Principal (€156.7M)</option>
                            </select>
                        </div>

                        <div id="stress-test-params" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">Scénarios</label>
                                <div class="space-y-2" id="scenarios-list">
                                    <!-- Rempli dynamiquement -->
                                </div>
                            </div>
                        </div>

                        <div id="market-risk-params" class="space-y-4 hidden">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Niveau de confiance</label>
                                    <select class="w-full p-2 border rounded">
                                        <option value="0.95">95%</option>
                                        <option value="0.99">99%</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Horizon temporel (jours)</label>
                                    <input type="number" value="1" class="w-full p-2 border rounded">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="flex space-x-4 mt-6">
                        <button type="button" onclick="finRiskApp.hideModal('simulation-modal')" class="flex-1 bg-gray-500 text-white py-2 px-4 rounded hover:bg-gray-600">
                            Annuler
                        </button>
                        <button type="submit" class="flex-1 bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700">
                            Lancer la Simulation
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Portefeuille -->
    <div id="portfolio-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b">
                <h3 class="text-xl font-bold">Nouveau Portefeuille</h3>
            </div>
            <div class="p-6">
                <form id="portfolio-form">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Nom du Portefeuille</label>
                            <input type="text" class="w-full p-2 border rounded" placeholder="Portefeuille d'investissement" required>
                        </div>

                        <div>
                            <label class="block text-sm font-medium mb-2">Description</label>
                            <textarea class="w-full p-2 border rounded" rows="3" placeholder="Description du portefeuille..."></textarea>
                        </div>

                        <div>
                            <label class="block text-sm font-medium mb-2">Actifs</label>
                            <div id="assets-container" class="space-y-3">
                                <!-- Actifs dynamiques -->
                            </div>
                            <button type="button" onclick="finRiskApp.addAsset()" class="mt-2 bg-gray-100 text-gray-700 py-2 px-4 rounded hover:bg-gray-200">
                                + Ajouter un actif
                            </button>
                        </div>
                    </div>

                    <div class="flex space-x-4 mt-6">
                        <button type="button" onclick="finRiskApp.hideModal('portfolio-modal')" class="flex-1 bg-gray-500 text-white py-2 px-4 rounded hover:bg-gray-600">
                            Annuler
                        </button>
                        <button type="submit" class="flex-1 bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700">
                            Créer le Portefeuille
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Résultats -->
    <div id="results-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b">
                <h3 class="text-xl font-bold">Résultats de la Simulation</h3>
            </div>
            <div class="p-6" id="results-content">
                <!-- Contenu dynamique -->
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>